name: nova-blueprint

services:
  nova-blueprint:
    image: ${VALIDATOR_IMAGE:-urdof7/nova-blueprint:latest}
    container_name: nova-blueprint
    restart: "no"
    working_dir: /app
    gpus: all
    init: true
    stop_grace_period: 24h
    env_file:
      - .env
    environment:
      - PYTHONPATH=/app
      - HOST_MINER_RUNS=${PWD}/data/miner_runs
      - HOST_RESULTS=${PWD}/data/results
    volumes:
      - ${BT_WALLETS_DIR:-$HOME/.bittensor/wallets}:/root/.bittensor/wallets:ro
      - ${PWD}/data/miner_runs:/data/miner_runs
      - ${PWD}/data/results:/data/results
      - /var/run/docker.sock:/var/run/docker.sock
    entrypoint: ["python", "neurons/validator/scheduler.py"]
    command: ["--wallet.name", "${BT_WALLET_COLD}", "--wallet.hotkey", "${BT_WALLET_HOT}", "--logging.debug"]

  watchtower:
    image: containrrr/watchtower:latest
    container_name: nova-blueprint-watchtower
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: ["--interval", "300", "--cleanup", "--stop-timeout", "24h", "nova-blueprint"]

